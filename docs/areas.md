# Участки

Вкладка «Участки» в разделе «Производство» предназначена для хранения и управления адресами точек и отрезков, на которых выполнялись работы по объекту.  
Участки используются **только** в связке с конкретными записями в [Журнале работ](works.md) и не могут существовать отдельно.

## Назначение
- Точная привязка выполненных работ к адресам (ПК или КМ) для исполнительной документации и аналитики.
- Упрощение заполнения Журнала работ.
- Возможность указывать несколько участков для одной записи о выполненных работах.

## Логика работы
Создание и удаление участков возможно из **двух мест**: из формы записи в «Журнале работ» **и** на вкладке «Участки».
Вкладка «Участки» предназначена для **тонких операций**: например, инженер может **разделить участок на две части** и включить в Акт **только вторую половину** — такие операции доступны **только** во вкладке «Участки».

- Каждый участок принадлежит **только одному** объекту.
- Каждый участок всегда связан **только с одной** записью в Журнале работ.
- Для одной записи можно создать несколько участков.
- Участок не может существовать без привязки к записи Журнала работ.
- При удалении участка из Журнала работ он удаляется **навсегда**, а не отправляется в архив.

## Поля участка
1. **Наименование** — человекочитаемое название (например, «Участок у моста»).
2. **Начальный адрес** — ПК или КМ (система отсчёта объекта).
3. **Конечный адрес** — ПК или КМ (система отсчёта объекта).  
   - Может быть одинаковым с начальным адресом (точка).  
   - Может быть пустым, если заполнен только начальный адрес.
4. **Сторона** — фиксированные значения: *Слева*, *Справа*, *Ось*.
5. **Комментарий** — опциональный, только для внутреннего использования, в документы не выводится.
6. **Привязка к записи Журнала работ** — обязательное поле, определяет, к какой работе относится участок.

## Права доступа
- Создание, редактирование и удаление участков возможно только при праве **Редактирование** на раздел **Журнал работ**.
- Для корректной работы системы **рекомендуется**: доступ к созданию/редактированию участков синхронизировать с доступом к Журналу работ, чтобы избежать ситуации, когда пользователь может редактировать записи, но не может управлять участками.
- Пользователи с правом **Чтение** могут просматривать все участки в рамках доступных им записей Журнала работ.

## Операции
- **Добавление участка** — только из формы редактирования/создания записи Журнала работ.
- **Редактирование** — возможно, если участок не заблокирован подписанным документом (Актом или другим связанным документом).
- **Удаление**:
  - Если удалён из записи Журнала работ — удаляется безвозвратно.
  - Архив для участков **не используется** (мгновенное удаление).

## Поиск и сортировка
- **Поиск** — по наименованию, адресам (начальный, конечный), стороне, комментарию.
- **Сортировка**:
  - По наименованию.
  - По начальному адресу.
  - По конечному адресу.
  - По стороне.

## Интеграция с Журналом работ
- Участки создаются и редактируются только в контексте конкретной записи Журнала работ.
- Если запись Журнала работ включена в Акт, который подписан, все связанные участки становятся заблокированными для редактирования и удаления.

## Формат адресации и хранение

**Назначение раздела:** хранение участков (отрезков) выполнения работ в пределах объекта.

### Поля участка

| Поле           | Тип          | Обязательно | Описание |
|----------------|--------------|-------------|----------|
| id             | UUID         | да          | Идентификатор участка (сервер). |
| objectId       | UUID         | да          | Объект, к которому относится участок. |
| side           | enum         | да          | `axis` / `left` / `right` — ось, левая или правая сторона. |
| startLabel     | string       | да          | Человекочитаемая метка начала (например, `ПК2+10`). |
| endLabel       | string       | да          | Человекочитаемая метка конца (например, `ПК7+80`). |
| startM         | integer      | да          | Начало в метрах от нулевой точки объекта (целое число). |
| endM           | integer      | да          | Конец в метрах от нулевой точки объекта (целое число). |
| lengthM        | integer      | да          | Длина участка в метрах (`endM - startM`, сервер вычисляет). |
| note           | string       | нет         | Примечание. |
| createdAt      | datetime ISO | да          | UTC. |
| updatedAt      | datetime ISO | да          | UTC. |

> `startLabel` / `endLabel` используются для ввода/отображения (ПК/КМ),
> а `startM` / `endM` — для вычислений/сортировки. Нулевая точка объекта определяется в карточке объекта или договорённостях проекта.

### Модель данных

**Координаты хранения:** `startM` и `endM` (целые метры от нулевой точки трассы).
**Представление в UI:** ПК в формате `ПК X+YY` вычисляется из метров, отдельно в БД не дублируется.

### Валидации

- `startM` и `endM` — целые числа; **`startM < endM`** обязательно.
- `lengthM = endM - startM` > 0.
- `side ∈ {axis, left, right}`.
- Диапазон участка должен укладываться в пределы объекта (если у объекта заданы границы).
- При создании/редактировании допускаются пересечения участков; система может показывать предупреждение о пересечении, но не блокирует сохранение.

### Сортировка и отображение

- Базовая сортировка: по `startM` возр., затем по `side` в порядке `axis` → `left` → `right`.
- В «Просмотре» участки выводятся в текущем порядке сортировки раздела.

### Печать/экспорт

- Не предусмотрены напрямую в разделе «Участки». Печатные формы, использующие участки (например, в Журнале работ или Акте), формируются через модуль **«Просмотр»** соответствующих разделов.
