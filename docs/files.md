# Файлы

Раздел «Файлы» — это хранилище всех документов, чертежей и вложений, связанных с конкретным объектом. Доступ к разделу возможен только после выбора объекта в меню.  

## Назначение
- Централизованное хранение проектной и исполнительной документации по объекту.
- Упрощённый доступ инженеров ко всем данным без необходимости использовать сторонние хранилища.
- Автоматическая организация вложений, добавляемых в других модулях (Акты, Ведомости и т.д.).

## Структура
- **Каждый объект** имеет собственный раздел «Файлы» и независимую файловую структуру.
- В разделе «Файлы» присутствуют:
  - **Пользовательские папки** — создаются и управляются пользователем.
  - **Системные папки** (нельзя удалить, но можно работать с содержимым):
    - `Приложения` — хранит вложения, добавленные через другие разделы (Журналы, Акты и т.д.).
    - `Ведомости` (планируется) — отдельное место для файлов ведомостей.
- Пользователь может:
  - Создавать и удалять свои папки.
  - Загружать любые файлы в пользовательские папки и системные (если это не нарушает регламент работы конкретной системной папки).
  - Перемещать и переименовывать файлы/папки при наличии прав.

## Форматы и ограничения
- Поддерживаются **любые форматы файлов**.
- Неподдерживаемые форматы для предпросмотра можно скачивать, но не отображать внутри интерфейса.

## Загрузка
- Максимальный размер **одного файла**: **500 МБ** (для всех тарифов).
- Параллельные загрузки — допускаются, серверная валидация размера.
  
## Корзина
- Для каждого объекта в разделе «Файлы» есть своя **отдельная корзина**.
- Размер занятого хранилища учитывает **все файлы**, включая находящиеся в корзине.
- Удаление — «мягкое»: файл перемещается в корзину.
- Удалённые файлы перемещаются в корзину на **30 дней**.
- Восстановление файлов возможно при праве **Редактирование** и выше.
- По истечении 30 дней удалённые файлы удаляются **безвозвратно**.

## Права доступа
- Доступ к папкам и файлам определяется правами на объект.
- Пользователи с правом **Чтение** и выше могут скачивать файлы.
- Если доступ к файлам ограничен на уровне объекта, пользователь не сможет попасть в раздел «Файлы» даже при прямой ссылке.
- Нельзя выдать доступ только к файлам без доступа к объекту.
- Прямые права на папки/файлы **не назначаются**: доступ определяется правами на объект/раздел согласно [Access](access.md). При понижении прав на уровне объекта доступ к «Файлам» объекта ограничивается автоматически.

## Поиск и сортировка
- Поиск работает **по имени файла и метаданным** (описание, автор, дата загрузки).
- Сортировка — по имени, размеру, дате загрузки.
- Фильтры — по формату, размеру или дате (отдельно от сортировки).

## Интеграция с другими модулями
- Вложения из модулей (Акты, Журналы и др.) сохраняются в папке **Приложения**.
- Удаление документа **не** удаляет его вложения — они остаются в папке «Приложения» до ручного удаления.
- Журнал работ не удаляется, поэтому вложения в нём сохраняются навсегда или до ручного удаления.
- Перенос документов между объектами **не допускается**.

## Хранилище и лимиты
- Все файлы объекта учитываются в общем лимите хранилища организации (см. [Тарифные планы](plans.md)).
- При превышении лимита загрузка файлов блокируется до освобождения места.

## Безопасность и доступ к файлам
- Архитектура хранения (локально или S3-совместимое облако) будет выбрана на финальном этапе проектирования.
- На текущем этапе предполагается, что ссылки на файлы **постоянные**, что позволит инженерам обмениваться ими между собой.

## Журнал действий
- Фиксируются операции:
  - Загрузка файла
  - Удаление файла
  - Восстановление из корзины
  - Перемещение и переименование
  - Скачивание
- Лог хранит: дату/время, пользователя, IP-адрес, действие, имя файла.
