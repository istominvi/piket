# Организации

Раздел «Организации» позволяет пользователю создавать юридические лица, управлять их данными, тарифами, контактами и сотрудниками, а также настраивать права доступа для других пользователей. Все последующие разделы приложения (Аналитика, Склады, Объекты и др.) находятся в подчинении выбранной активной организации.

## Назначение

- Хранение и управление данными организаций, с которыми работает пользователь.
- Переключение активной организации для доступа к связанным разделам.
- Разграничение прав на уровне организации и дочерних сущностей.

## Логика работы

- При первом входе нового пользователя (не состоящего ни в одной организации) список пуст, отображается кнопка **Добавить**.
- Пользователь всегда должен выбрать одну активную организацию, чтобы перейти в другие разделы меню.
- При обновлении страницы или перезапуске браузера активная организация сохраняется в `localStorage`.
- Возможна одновременная работа в нескольких организациях в разных вкладках браузера (активная организация хранится на уровне вкладки).
- Заголовок раздела в меню показывает название активной организации. По клику на название открывается список организаций, в котором активная организация отображается первой (дополнительная сортировка «выбранная — сверху», затем применяется выбранный режим сортировки).

## Активная организация и вкладки браузера

- Выбор активной организации сохраняется **в пределах текущей вкладки** (Session Storage).
- На соседней вкладке пользователь может выбрать другую активную организацию и работать параллельно.
- При открытии новой вкладки активная организация не наследуется автоматически; предлагается выбор из доступных.

## Список организаций

### Отображаемые столбцы
| Колонка           | Описание                                   |
|-------------------|---------------------------------------------|
| **Наименование**  | Сокращённое наименование юридического лица |
| **Подписка**      | Название тарифного плана                    |
| **Объекты**       | Количество всех объектов (активных и архивных) |
| **Хранилище**     | Использованный и доступный объём (например, `3,2 ГБ / 5 ГБ`) |
| **Подписка до**   | Дата окончания текущего оплаченного периода |

### Действия в списке
- **Добавить** — создаёт новую организацию.
- **Удалить** — доступно только пользователям с правом *Владелец*; удаление мягкое (архив на 30 дней), удалить из архива можно только по истечении этого срока.
- **Выбор активной** — через radio-кнопку; определяет, какие разделы отображаются в меню.

### Сортировка
- По клику на заголовок столбца (вверх/вниз).
- Отдельный фильтр «По использованию» (по дате последнего доступа), применяемый по умолчанию.
- Выбранные пользователем сортировка и фильтры сохраняются в `localStorage`.

## Создание и редактирование организации

**Поля:**
- Сокращённое наименование (обязательное)
- ИНН (обязательное, автозаполнение данных через ФНС на лету; 10 цифр для организаций, 12 — для ИП)
- Полное наименование (обязательное)
- Юридический адрес (обязательное, если автозаполнение не сработало)
- Тарифный план (по умолчанию «СТАРТ» — пробный 1 месяц, 1 объект, 1 ГБ)

**Валидация:**
- ИНН: проверка контрольной суммы и уникальности в системе.
- Ограничение длины строк.
- Если данные из ФНС не получены — пользователь может заполнить поля вручную.
- Поля, необходимые для формирования документов, должны быть заполнены; если их нет, система уведомляет об этом в момент формирования документа, с ссылкой на форму редактирования.

## Контакты

- **Тип:** Эл. почта, Телефон, Сайт (валидация формата; маска для телефона `+7 (___) ___-__-__`).
- **Значение:** само значение контакта.
- **Комментарий:** опциональный текст (например, «Бухгалтерия», «ПТО»).
- Допускается несколько контактов одного типа.

## Сотрудники

- **Должность** — текст.
- **Фамилия / Имя / Отчество** — отдельные поля.
- **Контакты** — аналогично контактам организации.
- **Связанный пользователь** — выбор из всех зарегистрированных пользователей Piket (необязательно).
  - Чтобы сотрудник стал пользователем с доступом, необходимо отдельно выдать права в разделе «Доступ».
- Один сотрудник может быть связан только с одним пользователем.
- Сотрудники используются для отображения в документах; права доступа имеют только пользователи.

## Управление доступом

- Кнопка «Доступ» (или «Права доступа»), доступная пользователям с правами управления доступом.
- Права:
  - **Чтение** — просмотр данных.
  - **Редактирование** — создание и изменение записей.
  - **Управление доступом** — выдача прав другим пользователям.
  - **Подписание** — утверждение актов и томов.
- Права наследуются от организации к объектам и подразделам.
- В дочерней сущности права можно понизить относительно родительских.

## Удаление

- Только владелец может удалить.
- Архив на 30 дней:
  - В архиве можно просматривать и восстанавливать сущности.
  - Удаление из архива — только после 30 дней.
- Восстановить может любой с правом «Редактирование» или выше.

## Связь с тарифами

- Пробный тариф «СТАРТ» активен 1 месяц, 1 объект, 1 ГБ хранилища.
- После окончания пробного периода — переход на платный тариф.
- При окончании подписки платного тарифа организация переходит в режим чтения.
- Все пользователи организации видят уведомление о блокировке.
