# Спецификация формы регистрации пользователя

## Назначение экрана

Экран регистрации предназначен для создания нового аккаунта в системе Piket.pro. Пользователь заполняет набор полей для идентификации, устанавливает пароль и подтверждает согласие с политикой конфиденциальности и офертой.

## Поля и правила валидации

| Поле           | Тип данных | Обязательность | Ограничения и проверки                                                                                                     |
|---------------|-----------|---------------|-----------------------------------------------------------------------------------------------------------------------------|
| **Имя пользователя** | Строка     | Да            | 3–30 символов; допускаются латиница, цифры и подчёркивания; проверяется на уникальность.                                    |
| **Электронная почта** | E‑mail     | Да            | Должна соответствовать формату `имя@домен.tld`; проверяется на уникальность.                                                |
| **Телефон**    | Телефон    | Да            | По умолчанию формат +7 (Россия), доступен выбор региона в выпадающем списке; маска ввода `+7 (___) ___‑__‑__`; проверяется валидатором `libphonenumber-js` на допустимость номера. |
| **Пароль**     | Пароль     | Да            | 8–32 символов; должен содержать минимум одну заглавную, одну строчную букву, одну цифру и один спецсимвол; рядом с полем расположена иконка для показа/скрытия пароля. |
| **Фамилия**    | Строка     | Да            | Только кириллические буквы; до 50 символов.                                                                                |
| **Имя**        | Строка     | Да            | Только кириллические буквы; до 50 символов.                                                                                |
| **Отчество**   | Строка     | Нет           | Только кириллические буквы; до 50 символов.                                                                                |
| **Согласие с политикой** | Чекбокс | Да            | Пользователь должен поставить галочку «Я принимаю условия политики конфиденциальности и оферты»; без галочки отправка формы невозможна. |

## Обработка события «Зарегистрироваться»

1. **Проверка обязательных полей.** Перед отправкой система проверяет, что все обязательные поля заполнены и проходят валидацию.
2. **Сообщения об ошибках.** При обнаружении ошибки рядом с соответствующим полем выводится сообщение: 
   - «Поле обязательно для заполнения» — если поле пустое;
   - «Недопустимый формат» — если формат поля не соответствует требованиям;
   - «Пользователь с таким именем/email уже существует» — если значение не уникально.
3. **Отправка на сервер.** При успешной валидации данные отправляются по защищённому соединению (HTTPS) на сервер. Сервер проверяет уникальность логина, email и телефона, хэширует пароль и создаёт запись о пользователе.
4. **Ответ сервера.** В случае успеха пользователь может быть автоматически авторизован или перенаправлен на страницу входа. В случае ошибки сервер возвращает описание, которое отображается пользователю.

## Навигация и интерфейсные элементы

- **Ссылка «← Назад».** Возвращает пользователя на предыдущую страницу. 
- **Ссылка «Войти →».** Открывает форму входа.
- **Индикатор надёжности пароля.** (необязательный элемент) может отображаться под полем ввода пароля и показывать степень сложности.
- **Кнопка «Зарегистрироваться».** Остаётся неактивной, пока не заполнены и не валидированы все обязательные поля. 
- **Текст согласия.** Короткая фраза «Я принимаю условия политики конфиденциальности и оферты», где слова «политики конфиденциальности» и «оферты» являются ссылками на соответствующие документы.

## Дополнительные требования

- **Доступность.** Контраст текста и фона соответствует стандарту WCAG 2.1 AA; все элементы формы доступны с клавиатуры и имеют подписи для скринридеров.
- **Адаптивность.** Форма должна корректно отображаться на мобильных устройствах и на десктопах.
- **Безопасность.** Все данные передаются только по протоколу HTTPS. Пароли хранятся в базе в виде хэш-сумм.

Эта спецификация подлежит включению в раздел «Требования» вашего ТЗ и служит основой для реализации и тестирования формы регистрации.

## Регистрация

### Режимы
1) **По приглашению** — пользователь переходит по ссылке-приглашению и присоединяется к существующей организации.
2) **Самостоятельная регистрация** — вместе с профилем создаётся новая организация.

### Поля формы (самостоятельная регистрация)
| Поле                 | Тип     | Обязательно | Правила |
|----------------------|---------|-------------|---------|
| Имя и фамилия        | string  | да          | От 2 до 100 символов. |
| E-mail               | string  | да          | Валидный адрес, уникален в системе. |
| Пароль               | string  | да          | От 8 до 72 символов. |
| Подтверждение пароля | string  | да          | Совпадает с «Пароль». |
| Название организации | string  | да          | Уникально в пределах аккаунта пользователя; от 2 до 120 символов. |
| Согласие с условиями | boolean | да          | Галочка обязательна для продолжения. |

### Поля формы (по приглашению)
| Поле                 | Тип     | Обязательно | Правила |
|----------------------|---------|-------------|---------|
| Имя и фамилия        | string  | да          | От 2 до 100 символов. |
| E-mail               | string  | да          | Предзаполнен из приглашения (если есть), можно изменить. |
| Пароль               | string  | да          | От 8 до 72 символов. |
| Подтверждение пароля | string  | да          | Совпадает с «Пароль». |

### Валидации
- Пароль: от 8 символов; пробелы по краям обрезаются.
- E-mail: валидный формат; при дубликате — «Пользователь с таким e-mail уже зарегистрирован».
- Название организации: обязательное поле только при самостоятельной регистрации.

### Подтверждение e-mail
- После регистрации отправляется письмо для подтверждения.
- До подтверждения доступ к проектным данным ограничен; показывается баннер с кнопкой «Отправить письмо повторно».

### Ограничения и защита от злоупотреблений
- Не более **3 регистраций** с одного IP за **1 час** (мягкий лимит).
- Повторная отправка письма подтверждения — не чаще **1 раза в 60 секунд**.
- Ошибки формулируются нейтрально, без раскрытия внутренней информации.

### UX-состояния
- Кнопка «Зарегистрироваться» неактивна, если форма невалидна / идёт запрос.
- Успешная регистрация: экран «Проверьте почту, чтобы подтвердить адрес».
- При регистрации по приглашению — после завершения сразу переход в приложение (если подтверждение не требуется отдельно).

### Выбор организации после регистрации
- Самостоятельная регистрация: создаётся организация с указанным названием и делается активной.
- По приглашению: активной становится организация из приглашения; при наличии нескольких — показывается селектор.

