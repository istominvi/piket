# Журнал работ

Журнал работ — это основная вкладка раздела «Производство».  
В нём хранятся записи о выполненных работах, которые являются исходными данными для формирования исполнительной документации, актов, отчётов и аналитики.

## Назначение
- Фиксация факта выполнения работ с указанием даты, времени, условий и местоположения.
- Основа для автоматического формирования актов и других документов.
- Источник данных для аналитики по объекту.

## Логика работы
- Журнал работ доступен только внутри выбранного объекта.
- Каждая запись может включать одну или несколько связанных [Участков](areas.md).
- Все поля записи валидируются перед сохранением.
- При выборе объекта в меню «Производство» открывается вкладка «Журнал работ» по умолчанию.

## Поля записи
1. **Работа**  
   - Выбирается из справочника «Реестр работ».  
   - Ввод вручную в обход справочника запрещён.
2. **Дата и время выполнения**  
   - Заполняются вручную.  
   - По умолчанию: текущая дата и время на +10 минут от предыдущей записи.
3. **Погодные условия**  
   - Определяются автоматически через сервис *Яндекс.Погода* на основе координат объекта.
   - Можно отредактировать вручную.
4. **Участки выполнения**  
   - Выбираются или создаются прямо в форме записи.  
   - Каждый участок связан только с одной записью.  
   - Возможность указать несколько участков в одной записи.
5. **Сумма объёма работ**  
   - Рассчитывается автоматически как сумма объёмов всех участков в записи.
6. **Тип работ**  
   - Значения: *Ответственная*, *Скрытая*, *Оба*.

## Права доступа
- Права наследуются от раздела «Производство» и объекта.
- Можно выдать отдельные права на «Журнал работ».
- **Редактирование**: добавление, изменение и удаление записей.
- **Чтение**: просмотр записей и связанных участков.
- История изменений сохраняется для каждой записи.

## Участки
- Каждая запись может содержать несколько [Участков](areas.md).
- Участки создаются и редактируются прямо из формы записи.
- Участок не может существовать без привязки к записи.
- Если запись включена в подписанный Акт, все её участки блокируются для редактирования и удаления.

## Архив
- Записи можно переместить в архив.
- Из архива можно восстановить запись в течение установленного периода.
- Удаление из архива — безвозвратное.
- Архивные записи не участвуют в формировании новых документов.

## Сортировка
Возможные варианты сортировки:
1. По наименованию работы.
2. По типу.
3. По дате выполнения.
4. По начальному адресу.
5. По конечному адресу.
6. По объёму.

## Фильтры
- Фильтрация может применяться без сохранения фильтра.
- Если все чекбоксы фильтра пустые — отображаются все записи.
- При выборе хотя бы одного чекбокса применяются только соответствующие записи.
- Кнопка **Добавить** сохраняет фильтр каждый раз, даже при одинаковых параметрах (добавляется постфикс к названию).
- Для удаления фильтра(ов) нужно выделить их, после чего кнопка **Удалить** станет активной.
- Для изменения сохранённого фильтра нужно его выделить, изменить параметры и сохранить.

## Дополнительно
- Импорт данных из внешних файлов (Excel/CSV) не предусмотрен.
- Все записи должны содержать хотя бы один участок с привязкой к адресу (ПК или КМ).

## Просмотр и печать «Общего журнала работ»

- В панели над списком есть кнопка **«Просмотр»**.
- Если выделены строки — формируется печатная версия **только выделенных** записей; если нет — берётся **текущая выборка по фильтрам**.
- Открывается модуль **«Просмотр»** (модальное окно). В левой колонке — навигация, справа — листаемый превью.
- Кнопка **«Печать»** доступна **только** внутри «Просмотра» и запускает печать средствами браузера.
- **Экспорт/скачивание отсутствуют.** Печатная форма создаётся для печати/сохранения в PDF через диалог браузера.

### Статусы и права

- Статусы записей журнала: **Черновик** (разрешено редактировать) и **Архив** (только просмотр).
- Для открытия «Просмотра» достаточно права **«Чтение»**. Редактирование — право **«Редактирование»**.
