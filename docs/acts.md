# Акты

## Назначение
Акт — это документ, фиксирующий объём выполненных работ за определённый период в рамках выбранного тома. Его основная задача — собрать все участки, на которых выполнялась конкретная работа, посчитать их общий объём и подготовить данные для отчётности перед заказчиком.

При агрегации участков выполненных работ в актах:
- Совпадающие адреса слева и справа от оси дороги объединяются в общий отрезок.
- Остальные показываются отдельно с пометками «слева» и «справа».  
Пример:  
`Досыпка откосной части крупнообломочным щебенистым грунтом ПК 1+22 – ПК 2+10 слева, ПК 2+10 – ПК 2+44, ПК 2+44 – ПК 4+40 справа`.

---

## Действия
- Создать акт → редактировать (черновик).
- **Подписать** (зафиксировать в системе).
- **Снять подпись** (вернуть в черновик, требуется указать причину).
- Отметить «Подписано у заказчика» (если был подписан бумажный экземпляр).
- Печать/Экспорт PDF.


## Нумерация актов
- Номер присваивается автоматически по последней дате выполнения работ в рамках тома.
- Дополнительный номер (`5/1`, `5/2` и т.д.) используется, если нужно добавить акт в середину уже существующей нумерации без её сдвига.

---

## Период
Период, за который собираются участки, задаётся двумя способами:

1. **Вручную** — начальная дата может быть любой в рамках объекта, конечная — только в диапазоне тома.
   - Если дата тома сдвигается на более раннюю — конечная дата акта тоже меняется.
   - Если дата тома сдвигается на более позднюю — конечная дата акта остаётся прежней.
   
2. **Автоматически по тому** *(выбрано по умолчанию)* — даты становятся неактивными.
   - Начальная дата = первая запись о выполнении выбранной работы.
   - Конечная дата = дата окончания тома и изменяется вместе с ней.

---

## Выбор работы
- Обязательно выбрать работу из Реестра работ, даже если она ещё не выполнялась.
- Дополнительное поле «Последующая работа» — опционально, для логически связанных работ.
- Можно создать пустой акт заранее, чтобы внести проектную документацию, отклонения, комиссию и приложения.

---

## Участки
- Опция **«Автоматически выбирать новые»** *(по умолчанию)* — новые участки в периоде акта добавляются в список уже с активными чекбоксами.
- В ручном режиме галочки придётся ставить самостоятельно.
- Участки можно добавить в акт прямо из Журнала работ или раздела Участки.

---

## Проектная документация
- Ссылка на раздел проектной документации, регламентирующий выполнение работ.
- Дополнительно можно указать изменения и отклонения.

---

## Комиссия
- Общий для всех актов в рамках объекта список участников.
- Можно выбрать, кого показывать в конкретном акте.
- Порядок участников можно менять перетаскиванием.
- По умолчанию подставляются участники из последнего акта с этой работой (или просто из последнего акта, если такого нет).
- Удалить можно только участника, который не фигурирует в других актах.

---

## Приложения
- Документы или сканы, идущие на печать, либо записи без файлов.
- Могут печататься сразу после акта или в конце тома.
- Все приложения из актов хранятся в системной папке **«Приложения»** в корне раздела «Файлы».
- Инкрементный поиск фильтрует список приложений.
- Выбранные приложения поднимаются в начало списка, где можно задать их порядок.

---

## Просмотр и печать

- В списке «Акты» в панели инструментов расположена кнопка **«Просмотр»**.
- Источник данных:
  - если есть выделение строк — берутся **выделенные акты** (в порядке, указанном сортировками списка);
  - если выделения нет — берётся **текущая выборка по фильтрам** списка.
- По нажатию открывается модуль **«Просмотр»** во всплывающем окне. Для каждого акта формируется **печатная версия** (HTML, пригодный для печати).
- В левой колонке «Просмотра» — навигация по актам и «Реестр актов» (оглавление), в правой — листаемый превью.
- Кнопка **«Печать»** находится **только** в модуле «Просмотр» и запускает печать средствами браузера.
- **Экспорт и загрузка файлов отсутствуют** — сервер не генерирует PDF/DOCX и не отдаёт файлы на скачивание.

### Статусы и ограничения

- **Черновик** — разрешено редактирование.
- **Подписан** — редактирование запрещено; доступен просмотр и печать через модуль «Просмотр».
- Смена статуса на «Подписан» требует права **«Подписание»**. Снятие подписи допускается только с указанием причины (логируется).

### Права доступа

- Просмотр/печать актов — право **«Чтение»**.
- Редактирование — **«Редактирование»**.
- Подписание — **«Подписание»**.
- Управление доступом — **«Управление доступом»**.
- Права на акты наследуются от прав на объект и раздел «Исполнение».
- Создавать, редактировать и удалять акты может пользователь с правами **Редактирование** или выше.
- Просматривать акты может любой пользователь с правами **Чтение** или выше.
- Если акт входит в подписанный том, то он и все связанные с ним сущности (участки, приложения) становятся **заблокированными для редактирования**.
- Удаление акта возможно только при отсутствии его в подписанном томе.
- Все действия с актами фиксируются в журнале аудита.

## Нумерация и наименования

- Поле **Номер акта** (`actNumber`) — обязательное, числовая последовательность в пределах **объекта** и **календарного года**.
- Правила:
  - при создании по умолчанию предлагается **следующий номер** (автоинкремент); номер можно изменить вручную до подписания;
  - номера **не переиспользуются** (удаление акта не освобождает номер);
  - допускается суффикс (например, `12а`) для ручных разветвлений;
  - формат отображения в списках: **«Акт №{actNumber} от {date}»**.
- **Дата акта** обязательна.
- При переводе в статус **«Подписан»** номер и дата **фиксируются** и далее не меняются.
- Поиск по актам учитывает номер, дату, объект и свободный текст заголовка.


